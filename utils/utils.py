
import numpy as np
import re

class MultiStepLRScheduler:
    def __init__(self, optimizer: object, epochs: object, init_lr: object, milestones: object, lrs: object) -> object:
        self.optimizer = optimizer
        self.epochs = epochs
        self.init_lr = init_lr
        self.lrs = self._generate_lr(milestones, lrs)
        self.current_epoch = 0

    def _generate_lr(self, milestones, lrs):
        milestones = [1] + milestones + [self.epochs + 1]
        lrs = [self.init_lr] + lrs
        lr_grouped = np.concatenate([np.ones((milestones[i + 1] - milestones[i], )) * lrs[i]
                                     for i in range(len(milestones) - 1)])
        return lr_grouped

    def step(self):
        lr = self.lrs[self.current_epoch]
        for group in self.optimizer.param_groups:
            group['lr'] = lr
        self.current_epoch += 1

    def reset(self):
        self.current_epoch = 0


def format_time(seconds):
    if seconds <= 60:
        time_str = '%.1fs' % seconds
    elif seconds <= 3600:
        time_str = '%dm%.1fs' % (seconds // 60, seconds % 60)
    else:
        time_str = '%dh%dm%.1fs' % (seconds // 3600, (seconds % 3600) // 60, seconds % 60)
    return time_str

def process_string(s):
    # remove all [**(text/number)**]
    s = re.sub(r'\[\*\*.*?\*\*\]', '', s)
    # remove special characters, keep punctuation marks
    s = re.sub(r'[^a-zA-Z0-9.,!? ]', '', s)
    s = s.lower()
    s = " ".join(s.split())
    return s

if __name__ == '__main__':
    s = """Baseline asrtifact. Sinus rhythm. Compared to the previous tracing of [**2154-10-31**]\nno diagnostic changes.\n\n. Normal sinus rhythm. Tracing is within normal limits. Compared to the previous\ntracing of [**2154-10-29**] no definite change.\n\n. Sinus rhythm\n[**Month (only) 1**] be normal ECG but consider possible prior inferior myocardial infarction\nalthough not diagnostic\nClinical correlation is suggested\nSince previous tracing of [**2154-10-28**], no significant change\n\n. Sinus rhythm\n[**Month (only) 1**] be normal ECG but consider possible prior inferior myocardial infarction\nalthough not diagnostic\nClinical correlation is suggested\nNo previous tracing for comparison\n\n. [**2154-10-28**] 4:00 PM\n MR HEAD W/O CONTRAST; MR-ANGIO HEAD                             Clip # [**Clip Number (Radiology) 107042**]\n Reason: ?embolic stroke\n Admitting Diagnosis: CAROTID STENOSIS;CORONARY ARTERY DISEASE\\CAROTID ANGIOGRAM;CATH\n ______________________________________________________________________________\n [**Hospital 4**] MEDICAL CONDITION:\n  80 year old woman with transient aphasia, left-sided neglect during carotid\n  angiography this morning.\n REASON FOR THIS EXAMINATION:\n  ?embolic stroke\n ______________________________________________________________________________\n                                 FINAL REPORT\n MRI OF THE BRAIN WITH MRA OF THE CIRCLE OF [**Location (un) 52**]:\n\n INDICATION:  Transient aphasia and left sided neglect.  Question embolic\n stroke.\n\n Multiplanar T1 and T2 weighted images of the brain are obtained.  Diffusion\n images in addition to 3D TOF MRA of the circle of [**Location (un) **] was performed.\n\n No prior MRI exams are available for comparison.  There are no acute\n territorial infarcts seen within the brain on diffusion images.  Scattered\n foci of T2 hyperintensity are seen within the periventricular white matter and\n centrum semiovale suggestive of chronic microvascular ischemic changes.  There\n is generalized sulcal dilatation suggestive of age related atrophy.  Some of\n the T2 weighted images were degraded by motion artifact.  There is increased\n T2 signal within the left mastoid sinus suggestive of possible mastoiditis of\n uncertain age.\n\n MRA of the cirle of [**Location (un) **] was degraded by motion artifact.  There is possible\n mild narrowing of the distal right vertebral artery.  The basilar artery is\n unremarkable.  There is diffuse atherosclerotic disease and narrowing\n involving the left petrous portion of the ICA in addition to the left\n cavernous portion of the left ICA.  The visualized anterior and middle\n cerebral arteries are patent.\n\n IMPRESSION:\n\n 1)  No acute territorial infarct seen within the brain.\n 2)  chronic periventricular white matter ischemic changes.\n 3)  Diffuse attenuation of signal due to moderate to significant stenosis\n estimated to be around 70-80% of the left petrous and cavernous ICA.  The MRA\n exam overall was degraded by motion artifact.  There is also mild disease\n involving the distal right vertebral artery.  The basilar artery is\n unremarkable.\n\n. CCU NURSING PROGRESS NOTE 11P-7A\n\nNEURO: alert and oriented x3. Cooperative with care. Able to follow commands, PERL. Neuro exam intact.\n\nRESP: LS diminished throughout. Sats 92-97% on 4L NC.\n\nCARDIAC: Req\'g Nipride gtt (0.3->1.0 mcg/mg/min) to maintain SBP 140-160 range. BP transiently dips to 120\'s, however mostly maintained within range on low dose nipride. HR 70\'s NSR. Awaiting fem-[**Doctor Last Name 419**] bypass surgery on friday (clot and u/a sent this morning).\nRight groin clean and dry. No s/s hematoma. Transparent dressing intact.  Bilateral dopplerable pedal pulses.\n\nGI: Rec\'g 1/2 NS @75cc/hr (to be dc\'d once this liter is finished). Abd soft NT. +BS.\n\nGU: Foley cath draining clear yellow urine. +388cc this am.\n\nID: T max 99.8. Conts on IV unasyn q8hrs.\n\nA: VSS.  No further neuro events noted.\n\nP: cont to follow neuro exam. Fem-[**Doctor Last Name 419**] bypass surgery on Friday. Maintain SBP 140-160.\n. ccu nursing progress note\ns: no complaints\no: pls see carevue flowsheet for complete vs/data/events\ncv: sr 80s, no vea. k and mg repleted. bp 120-180/60-80 via l rad art line. cont on nipride dose varying from .2-.8mcg/kg/min. starting lopressor this eve preop.\nrec\'d 2u prbcs today for hct 24.8. hct sent at 6pm as 2nd unit completing, pend.\nresp: cxs at bases. sats 92% on 2l nc, up to 3l nc.\ngi: tol diet. had lrg soft, ob- bm today. npo after mn. bs 230-270, covered per ss.\ngu: poor uop 30-50cc/hr. 1l+ from mn w 2u prbcs. ordered for lasix this eve.\nms: intact. mae w purpose. sleeping in sm naps. family visiting throughout day.\nplan for fempop bypass [**11-1**] 1pm.\na: s/p 2u prbcs\np: assess response to lasix. wean nipride as tol. npo after mn. cont to follow neuro exam.\n. CCU NSG NOTE: ALT IN NEURO/PVD\nS: "I don\'t remember anything about the test"\nO: For complete admission information see admit note.\nThis 80y old female tranfer from [**Hospital3 8199**] for carotid study in preparation for fem-[**Doctor Last Name 419**] bipass/?L toe amputation, became acutely aphasic with L neglect while carotid dye being shot. She was started on integrellin. She had been started on IV nitro for BP in 200/70s. BP came down to 150s at time when neuro changes occured. Nitro off. Within an hour symptoms resolved with no focal deficits. She was admitted to CCU and shortly after went for MRI. MRI showed small [**Doctor Last Name **] in the cerebellum.\nNEURO: Pt has been alert, and oriented X 3. She goes to sleep when left alone, but is easily rouseable. She is moving all 4 extremities on command. She does demonstrate a L neglect, with diminished sensation if left is stimulated at the same time as the Right. Strenght on L is good when that side is stimulated. Pupils are equal and reactive. Her smile is symetrical.\nCV: HR has been 63-67 NSR with no ectopy. BP has been 193-213/60-69 by R femoral a-line. Is BP drops below 180 systolic neo should be started. Integrellin was d/c at 1800 and she will be started on IV heparin at 1000u/hr with no bolus at 8pm. PTT goal is 60-80. Her groin is dry with no ooze or hematoma. Pulses on R are easily dopplerable, the L pulses are dopplerable with a swishing noise, not a clear pulse. Left foot is warm, Right is cool. She is receiving 1/2 NS at 150 hr X 3 liters.\nRESP: RR 14-18, she is sating 96% on 2L NP. She has decreased breath sounds.\nGI: Pt NPO.\nRENAL: BUN/creat 8/.6. Foley draining lt pink urine. She is ~500cc neg today.\nSKIN: Left foot is red and hot. The small toes is black and ulcerated.\nSHe has a scab on joint of great toe. The foot is very painful.\nENDO: FS was 158 and she received 2u reg insulin.\nID: WBC this am 12.7. She will start IV unison tonight.\nA: Small CVAs. foot ulcer\nP: Neuro checks Q 1 hour. Start heparin at 8am at 1000u. Start unisyn when it arrives at floor. Keep careful I & O. Monitor for change.\n. CCU NSG NOTE: ALT IN NEURO/PVD\nCorrection: start heparin at 8pm [**10-28**]\n. 7p-7a\ns: "how did i get here"\no/a: pt a/o mostly except didn\'t remember name of this hospital, then as night went on pt appearing a little vague, as she went off to deep sleep and being awoken for q 1hr neuro checks she was only oriented to person but unable to say correctly that she was in the hospital, then consistently her motor skills have been intact, she follows commands to grasp hands and squeeze (equally) to push and pull with hands and feet, she [**Last Name (un) **] move all her extremeties normally when asked, pupils equal and rx bsk, and smile symmetrical but slow to smile as if she didn\'t quite understand what i was asking. as for sensation in her upper arms this test needed to be done a few times before pt could understand what was being asked and could answer correctly. at 0100 the ho\'s came in and assessed her to see if they were finding what I was finding on neuro exam. they thought that she was still fine and not concerned, they explained they thought there was some mild dementia at her baseline now this am at 515 her son informs me that she is usually sharp as a tack.\nresp: pt on 3.5 liters n/c sats 97-99% lungs clear but especially diminished in left base. resps 16-22\ncv: pt sr 58-73, bp 173-201/59-78, neo drip not started and parameters changed by resident to start if sbp less thab 165. no c/os cp. hep drip up at 8p at 1000u and increased at 0400 to 1350 and bolused 3500\nnext ptt at 10am.\ngi: abd obese pos bs nontender, had few ice chips swallowing ok npo after midnight for possible carotid stent.\ngu: foley in place dk yellow urine 25-80/hr 900+ .\nid: temp max 98.9 po pt on unasyn\nskin: left small toe black, vascular consulted last eve and placed a dsd over foot apparently to be changed qd. pt c/o it was painfull pt received tylenol at 10p with good effect, and repositiong side to side also helped, r groin site looks wnl and dopppler pulses x 4\nplan: am labs monitor neuro checks son present in room, await possible carotid stent today\n. CCU NPN: Alt in CV and Neurological\nS: "Be careful of my toe."\nO: Please see carview flowsheet for complete details.\nID: Pt remains afebrile with a WBB of 11.4. Pt on Unasyn for cellulitis of LLE.\nCV: Pt in NSR/SB (HR= 59-70)with no ectopy. Pt denies any chest pain.  Pt\'s BP 190-179/50-60 via RF a-line. Pt\'s NBP reads 25-30 points lower with Right arm [**Location (un) **] higher than left. Pt denies chest pain. Pt received on Heparin at 1350 units/hr this am. 11AM PTT subtherapeutic, but Heparin stopped at 1230 for removal of right femoral art-line. Pt is to remain on bedrest with right leg immobile until 7pm because of sheath removal. Right femoral site is clean and dry with tegaderm in place.  Heparin to be restarted after ultrasound at 1400units/hr [**Name8 (MD) 20**] MD [**Last Name (Titles) **]. K+ 4.3 and Mg 2.2\nResp: Lung sounds clear, but diminished at bases bilaterally.  Pt on 3L NC with an O2 sat of 94-97%.\nNeuro: Pt is A+Ox3, but sometimes a little groggy when awoken. Pt now on q2h neuro checks. Pupils are 3-4mm and briskly reactive. Pt with good strength in all 4 extremities. Pt has intermittent tactile\nnegect on left side in lower extremities x1 this am.\nGI: Pt started on heart healthy diet today and ate a small amount for breakfast and did not want lunch. Pt has + bowel sounds and abdomen is soft and obese. Pt has not had a BM. Pt to ne NPO after MN for Carotid stenting tomorrow.\nGU: Pt is draining adequate amounts of clear yellow urine via foley catheter. Pt has completed 3L 0.45NS post cath hydration with a discontinuation of IV fluid.\nEndo: Pt fs 130-154 with 2units RHI SQ coverage at noon.\nPain: Pt complaiing of spasming discomfort in left pinky toe. Tylenol given x1 this shift with good effect.\nSkin: Pt\'s left pinky toe is black and lower leg is reddened and warm. Dry dressing applied to site per Vascular surgery.\nA: Pt with minor neurological defecits resolving. Pt with severe PVD, L carotid stenosis, and hypertension. Pt with necrotic left pinky toe and cellulitits of LLE. Pt with DM.\nP: Continue to monitor neuro status q2h. Maintain NBP> 150 with Neosynephrine if necessary.  Monitor LE pulses. Monitor pain and site of LLE. Maintain patient on bedrest with minimal movement for right groin sheath removal. Restart Heparin at 1400units/hr upon return from procedure today and draw PTT after 6 hours. Pt NPO after MN for L carotid stenting tomorrow. Plan for Vascular surgery on left leg Friday.\n\n. 7p-7a\nS: "i\'m at [**First Name8 (NamePattern2) **] [**Last Name (NamePattern1) **]"\no/a: pt much more alert and oriented this shift than last hs. pt answering appropriately, motor and facial intact, as well as her sensory, grasps equal moving all extremeties, pupils equal and rx.\nresp: pt continues on 3l n/c sats 91-98% lungs clear but dim in bases\nno c/o sob, rr 17-22\ncv: sr 53-67 no ectopy noted, bp 130-180/22-47, prior to 7p neo drip started at .10 and was keeping bp >150 at 0200 sbp to 180 neo titrated down and off pt also lying flat at the time shortly thereafter pt repos to left side bp to 130-140, neo drip back on and up to .20 currently to maintain her bp >150 even when pt on her back. hep drip at 1550 am ptt 67.3 therapeutic next ptt at 10am.\ngi: abd soft nontender pos bs, npo after mn for carotid stent this am,\nfs 151 got 2 units at mn\ngu: foley was putting out urine qs until around mn urine declining until she wasn\'t making any and she ended up needing to be bolused 500 x 2 ns and then ivf ns started 125 at 0530, still only making small amts urine\nid: pt on unasyn for left foot cellulitis temp max 98.9 po\nskin: left foot has 2 black spots on inner and outer aspect of her left foot and a black pinky toe, dsd applied and foot placed in waffle boot, pt c/o pain there and was medicated with tylenol and oxycodone pre 7p and got 2 tylenol at 0300 with good effect. pt moves self side to side in bed freq.\nplan: pt to have carotid stent this am, watch fluid status, bp on neo drip, cont q 2 neuro checks, cont full support.\n. 7a-7p\nneuro: lethargic, easily aroused, follows commands, moving all extremities, perl, oriented x 3\n\ncv: hr nsr, no ectopy, sbp 122-180, L carotid stent placed in cath lab this am, neo gtt dc\'d in lab & nipride gtt started(goal sbp 140-160), 1 mg atropine given in lab for bradycardia otherwise stable during procedure, no neuro deficits noted, sbp labile in ccu & nipride gtt titrated(0.1-0.4mic/kg/min) to keep sbp 140-160, 300 mg plavix given in lab & daily dose ordered(75 mg), continues on daily asa, pt to continue plavix even though OR scheduled for Friday(fem-[**Doctor Last Name 419**] bpg), Dr. [**Last Name (STitle) 11165**] in to see pt this afternoon, iv heparin dc\'d in cath lab, R fem sheath dc\'d by cardiology fellow @ 1250 without incident, no hematoma or bleeding noted, distal pulses by doppler\n\nresp: on [**2-5**] l np, sat 95-99, rr 18-24, bs+ all lobes & clear, diminished to bases, encouraged to deep breath @ times(sat dips down to low 90\'s), non-productive cough, no sob or resp distress noted\n\ngi: sips water given prior to sheath pull, may advance to dat, no stool/nausea or vomiting\n\ngu: foley patent, clear yellow urine, adequate uo\n\nother: family in & updated on pt\'s condition, post procedure iv fluids= 1/2 ns @ 100cc/hr x 2 liters, K+ & MG+ repleated, dsd to L foot d&i, waffle boot to L foot, knee imobilizer to R leg, po tylenol x 1 for leg & back pain\n\nplan: continue to monitor neuro/vs in ccu, neo/snp gtts as needed to keep sbp 140-160, npo after MN [**10-31**] for OR on Friday\n. CCU NPN 7P-7A\nS:"I don\'t feel like I have a fever."\n\nO: Please see carevue for VS and objective data.\n\nCVS: Hemodynamically stable with HR 56-70\'S NSB/NSR, no vea noted, lytes repleted. Tolerated 25mg po Lopressor at [**2150**]. BP ranges via left radial aline 129-170/40-60. MAPs 70-90. IV Nipride titrated as per flow to maintain SBP 140-160. IV Nipride presently at 0.6 mcg/kg/min.\n\nResp; Sats 93-96% on 2L n/c, lungs with fine bibasilar rales, diminished bases. Diuresised >1L to 20mg IV Lasix given at [**2080**]. Rare non-productive cough, unable to raise sputum. RR 16-21.\n\nID: Temp spike to 101.2 po at [**2150**], urine and blood cultures sent, given po tylenol, conts on IV Unasyn q8hours, WBC 10.6, DIFF pnd. Temp down to 97.5 po. Left foot with necrotic areas on  small toe and dime size area on inner aspect of left foot. DSD changed. Foot remains red and warm to touch. CXR of previous shift without infiltrate per CCU team report, mild failure.\n\nGI:GU:/Endo: Taking pos, NPO after MN for possible fem-[**Doctor Last Name 419**] bypass in am. Voiding qs via foley u/o 30-550cc/hour with diuresis. Red rash noted at groin folds around labia. No stool this shift. Conts on SS Regular insulin as ordered.\n\nNeuro: Pt. A/A/Ox3, cooperative. MAE. Hand grasps equal, tongue midline, smile symmetrical. PERL, 3MM. Following all commands, repositioned with assist. Slept well most of shift.\n\nHeme: Repeat Hct post tranfusions of previous shift 29.0 - 31.5. Without further transfusions.\n\nA; Hemodynamically stable with titration on IV Nipride to maintain SBP 140-160. Awaiting fem-[**Doctor Last Name 419**] bypass. Temp spike\n\nP: Cont to monitor hemodynamics, maintain SBP 140-160. Follow up with am labs, cultures pnd. Vascular [**Doctor First Name **]. planned for today pnd cultures, team decision. Remains NPO. Check with CCU team in am for nystatin powder for groin area. Comfort and emotional support to Pt. and family\n\n\n"""
    process_string(s)